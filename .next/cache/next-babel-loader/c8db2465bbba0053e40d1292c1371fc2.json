{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/mnt/c/Users/D.Hardiman/desktop/eurobrake/pages/login.js\";\nvar __jsx = React.createElement;\nimport React, { Component } from 'react';\nimport styled from 'styled-components';\nimport fetch from 'isomorphic-unfetch';\nimport { login } from '../utils/auth';\nvar DemoDiv = styled.form.withConfig({\n  displayName: \"login__DemoDiv\",\n  componentId: \"cxdurq-0\"\n})([\"display:flex;flex-direction:column;align-self:center;max-width:\", \";\"], function (props) {\n  return props.theme.maxWidth;\n});\nvar Demo = styled.h1.withConfig({\n  displayName: \"login__Demo\",\n  componentId: \"cxdurq-1\"\n})([\"padding:10rem;margin:5rem;color:orangered;\"]);\n\nvar Login =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Login, _Component);\n\n  function Login(props) {\n    var _this;\n\n    _classCallCheck(this, Login);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Login).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"saveToState\", function (e) {\n      _this.setState(_defineProperty({}, e.target.name, e.target.value));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSubmit\",\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(e) {\n        var _this$state, authorLogin, username, password, error, formData, response, data, _ref2, logintoken, _error;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                e.preventDefault();\n                console.log('on submit click');\n                _this$state = _this.state, authorLogin = _this$state.authorLogin, username = _this$state.username, password = _this$state.password, error = _this$state.error; // const apiUrl = authorLogin ? 'https://prelude.eurobrake.net/login' : '' ;\n                // action=\"//2019.eurobrake.net/exhibition/exhibitors/login\" SHOULD BE LOGIN FORM FOR EXHIBITORS\n\n                formData = {\n                  username: username,\n                  password: password\n                };\n                _context.prev = 4;\n                _context.next = 7;\n                return fetch('https://prelude.eurobrake.net/login', {\n                  method: 'POST',\n                  credentials: 'include',\n                  // ? Is allowing now?? \n                  body: _JSON$stringify(formData)\n                });\n\n              case 7:\n                response = _context.sent;\n                _context.next = 10;\n                return response.json();\n\n              case 10:\n                data = _context.sent;\n                console.log({\n                  data: data\n                });\n\n                if (!(data.status === 'success')) {\n                  _context.next = 22;\n                  break;\n                }\n\n                _context.next = 15;\n                return data;\n\n              case 15:\n                _ref2 = _context.sent;\n                logintoken = _ref2.logintoken;\n                _context.next = 19;\n                return login({\n                  logintoken: logintoken\n                });\n\n              case 19:\n                console.log('login ok', data.status);\n                _context.next = 25;\n                break;\n\n              case 22:\n                _error = new Error(data.error);\n                _error.response = response;\n                throw _error;\n\n              case 25:\n                _context.next = 31;\n                break;\n\n              case 27:\n                _context.prev = 27;\n                _context.t0 = _context[\"catch\"](4);\n                console.error('Failed to login, please try again', _context.t0);\n\n                _this.setState({\n                  error: _context.t0.message\n                });\n\n              case 31:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[4, 27]]);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n\n    _this.state = {\n      username: '',\n      password: '',\n      authorLogin: true,\n      error: ''\n    };\n    return _this;\n  }\n\n  _createClass(Login, [{\n    key: \"render\",\n    value: function render() {\n      console.log(this.props);\n      var form = this.props.form.form;\n      return __jsx(DemoDiv, {\n        onSubmit: this.onSubmit,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 97\n        },\n        __self: this\n      }, __jsx(Demo, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 98\n        },\n        __self: this\n      }, __jsx(\"div\", {\n        className: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 100\n        },\n        __self: this\n      }, __jsx(\"label\", {\n        htmlFor: \"label\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 101\n        },\n        __self: this\n      }, \"Username\"), __jsx(\"input\", {\n        type: \"text\",\n        name: \"username\" // {form[0].name} \n        ,\n        onChange: this.saveToState,\n        value: this.state.username,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 105\n        },\n        __self: this\n      })), __jsx(\"div\", {\n        className: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 110\n        },\n        __self: this\n      }, __jsx(\"label\", {\n        htmlFor: \"label\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 111\n        },\n        __self: this\n      }, \"Password\"), __jsx(\"input\", {\n        type: \"password\",\n        name: \"password\" // {form[1].name}  \n        ,\n        onChange: this.saveToState,\n        value: this.state.password,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115\n        },\n        __self: this\n      }))), __jsx(\"input\", {\n        type: \"submit\",\n        value: \"Submit\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 121\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return Login;\n}(Component); // !!! NOTE IF I GO TO '/' IT GETS RID OF THE LOGGED IN COOKIE !!!\n\n\n_defineProperty(Login, \"getInitialProps\",\n/*#__PURE__*/\n_asyncToGenerator(\n/*#__PURE__*/\n_regeneratorRuntime.mark(function _callee2() {\n  var res, data;\n  return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return fetch('https://prelude.eurobrake.net/login');\n\n        case 2:\n          res = _context2.sent;\n          _context2.next = 5;\n          return res.json();\n\n        case 5:\n          data = _context2.sent;\n          return _context2.abrupt(\"return\", {\n            form: data\n          });\n\n        case 7:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _callee2);\n})));\n\nexport { Login as default };","map":{"version":3,"sources":["/mnt/c/Users/D.Hardiman/desktop/eurobrake/pages/login.js"],"names":["React","Component","styled","fetch","login","DemoDiv","form","props","theme","maxWidth","Demo","h1","Login","e","setState","target","name","value","preventDefault","console","log","state","authorLogin","username","password","error","formData","method","credentials","body","response","json","data","status","logintoken","Error","message","onSubmit","saveToState","res"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport styled from 'styled-components';\nimport fetch from 'isomorphic-unfetch';\nimport { login } from '../utils/auth';\n\n\n\nconst DemoDiv = styled.form`\n    display: flex;\n    flex-direction: column;\n    align-self: center; \n    max-width: ${props => props.theme.maxWidth};\n`;\n\n\nconst Demo = styled.h1`\n    padding: 10rem;\n    margin: 5rem;\n    color: orangered;\n\n`;\n\n\n\nexport default class Login extends Component {\n    static getInitialProps = async function () {\n        const res = await fetch('https://prelude.eurobrake.net/login');\n        const data = await res.json();\n        \n        return {\n            form: data\n        };\n    };\n\n   \nconstructor(props) {\n    super(props);\n    this.state={\n        username: '',\n        password: '',\n        authorLogin: true,\n        error: ''\n    }\n}\n\n    saveToState = (e) => {\n        this.setState({ [e.target.name]: e.target.value });\n    }\n   \n\n    onSubmit = async (e) =>{\n    e.preventDefault()\n    console.log('on submit click');\n        \n    const {authorLogin, username, password, error} = this.state;\n    // const apiUrl = authorLogin ? 'https://prelude.eurobrake.net/login' : '' ;\n// action=\"//2019.eurobrake.net/exhibition/exhibitors/login\" SHOULD BE LOGIN FORM FOR EXHIBITORS\n        const formData = {\n            username: username,\n            password: password,\n        }\n\n    \n    try{\n        const response = await fetch('https://prelude.eurobrake.net/login', {\n                method: 'POST',\n                credentials: 'include', // ? Is allowing now?? \n                body: JSON.stringify(formData)\n            });\n        const data = await response.json();\n\n       console.log({data})\n        \n        if(data.status === 'success') {           \n        const {logintoken} = await data;\n        await login({logintoken})\n        console.log('login ok', data.status)\n    }else{\n        let error = new Error(data.error)\n        error.response = response\n       throw error\n        }\n    }catch (error){\n        console.error(\n            'Failed to login, please try again', error\n            )\n       this.setState({error: error.message});\n    }\n\n}\n\n\nrender(){\n  console.log(this.props)\n    const {form} = this.props.form;\n        return (\n         <DemoDiv onSubmit={this.onSubmit}>\n            <Demo>\n\n            <div className=\"\">\n                <label htmlFor=\"label\">\n                    Username\n                    {/* {form[0].label} */}\n                    </label>\n                <input type=\"text\" \n                name=\"username\"\n                // {form[0].name} \n                 onChange={this.saveToState} value={this.state.username}/>\n            </div>\n            <div className=\"\">    \n                <label htmlFor=\"label\">\n                    Password\n                    {/* {form[1].label} */}\n                    </label>\n                <input type=\"password\" \n                name=\"password\"\n                // {form[1].name}  \n                onChange={this.saveToState} value={this.state.password}/>\n            </div>\n            </Demo>\n            <input type=\"submit\" value=\"Submit\"/>\n        </DemoDiv>\n        )\n    }\n}\n\n\n\n// !!! NOTE IF I GO TO '/' IT GETS RID OF THE LOGGED IN COOKIE !!!"]},"metadata":{},"sourceType":"module"}