{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\nimport React, { Component } from 'react';\nimport styled from 'styled-components';\nimport fetch from 'isomorphic-unfetch';\nimport { login } from '../utils/auth';\nvar DemoDiv = styled.form.withConfig({\n  displayName: \"login__DemoDiv\",\n  componentId: \"cxdurq-0\"\n})([\"display:flex;flex-direction:column;align-self:center;max-width:\", \";\"], function (props) {\n  return props.theme.maxWidth;\n});\nvar Demo = styled.h1.withConfig({\n  displayName: \"login__Demo\",\n  componentId: \"cxdurq-1\"\n})([\"padding:10rem;margin:5rem;color:orangered;\"]);\n\nvar Login =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Login, _Component);\n\n  function Login(props) {\n    var _this;\n\n    _classCallCheck(this, Login);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Login).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"saveToState\", function (e) {\n      _this.setState(_defineProperty({}, e.target.name, e.target.value));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSub\", function (e) {\n      e.preventDefault();\n      console.log('click1');\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSubmit\",\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(e) {\n        var _this$state, authorLogin, username, password, error, apiUrl, formData, response, _ref2, token, _error;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                e.preventDefault();\n                console.log('click');\n                _this$state = _this.state, authorLogin = _this$state.authorLogin, username = _this$state.username, password = _this$state.password, error = _this$state.error;\n                apiUrl = authorLogin ? 'https://prelude.eurobrake.net/login' : ''; // action=\"//2019.eurobrake.net/exhibition/exhibitors/login\" SHOULD BE LOGIN FORM FOR EXHIBITORS\n\n                formData = {\n                  username: username,\n                  password: password\n                };\n                _context.prev = 5;\n                _context.next = 8;\n                return fetch(apiUrl, {\n                  method: 'POST',\n                  credentials: 'include',\n                  body: _JSON$stringify(formData)\n                });\n\n              case 8:\n                response = _context.sent;\n\n                if (!(response.status === 200)) {\n                  _context.next = 18;\n                  break;\n                }\n\n                _context.next = 12;\n                return response.json();\n\n              case 12:\n                _ref2 = _context.sent;\n                token = _ref2.token;\n                _context.next = 16;\n                return login({\n                  token: token\n                });\n\n              case 16:\n                _context.next = 22;\n                break;\n\n              case 18:\n                console.log('login failed');\n                _error = new Error(response.statusText);\n                _error.response = response;\n                throw _error;\n\n              case 22:\n                _context.next = 28;\n                break;\n\n              case 24:\n                _context.prev = 24;\n                _context.t0 = _context[\"catch\"](5);\n                console.error('Failed to login, please try again', _context.t0);\n\n                _this.setState({\n                  error: _context.t0.message\n                });\n\n              case 28:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[5, 24]]);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n\n    _this.state = {\n      username: '',\n      password: '',\n      authorLogin: true,\n      error: ''\n    };\n    return _this;\n  }\n\n  _createClass(Login, [{\n    key: \"render\",\n    value: function render() {\n      console.log(this.props);\n      var form = this.props.form.form;\n      return __jsx(DemoDiv, {\n        onSubmit: this.onSubmit\n      }, __jsx(Demo, null, __jsx(\"div\", {\n        className: \"\"\n      }, __jsx(\"label\", {\n        htmlFor: \"label\"\n      }, form[0].label), __jsx(\"input\", {\n        type: \"text\",\n        name: form[0].name,\n        onChange: this.saveToState,\n        value: this.state.username\n      })), __jsx(\"div\", {\n        className: \"\"\n      }, __jsx(\"label\", {\n        htmlFor: \"label\"\n      }, form[1].label), __jsx(\"input\", {\n        type: \"password\",\n        name: form[1].name,\n        onChange: this.saveToState,\n        value: this.state.password\n      }))), __jsx(\"input\", {\n        type: \"submit\",\n        value: \"Submit\"\n      }));\n    }\n  }]);\n\n  return Login;\n}(Component); // !!! NOTE IF I GO TO '/' IT GETS RID OF THE LOGGED IN COOKIE !!!\n\n\n_defineProperty(Login, \"getInitialProps\",\n/*#__PURE__*/\n_asyncToGenerator(\n/*#__PURE__*/\n_regeneratorRuntime.mark(function _callee2() {\n  var res, data;\n  return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return fetch('https://prelude.eurobrake.net/login');\n\n        case 2:\n          res = _context2.sent;\n          _context2.next = 5;\n          return res.json()[\"catch\"](function (error) {\n            return console.log(error);\n          });\n\n        case 5:\n          data = _context2.sent;\n          ;\n          return _context2.abrupt(\"return\", {\n            form: data\n          });\n\n        case 8:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _callee2);\n})));\n\nexport { Login as default };","map":null,"metadata":{},"sourceType":"module"}