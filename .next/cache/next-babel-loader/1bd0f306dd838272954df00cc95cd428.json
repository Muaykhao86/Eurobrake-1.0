{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\nimport React, { Component } from 'react';\nimport styled from 'styled-components';\nimport fetch from 'isomorphic-unfetch';\nimport TextField from '@material-ui/core/TextField';\nimport { login, logout } from '../utils/auth';\nimport { Button } from './Button';\nvar StyledForm = styled.form.withConfig({\n  displayName: \"login__StyledForm\",\n  componentId: \"sc-1otdfux-0\"\n})([\"display:flex;flex-flow:column;justify-content:space-between;align-items:center;min-width:100%;.MuiInput-underline:after{color:\", \";}.MuiInputBase-root{font-family:\", \";font-size:2rem;color:\", \";}input:-internal-autofill-selected{}.login_form{&-field{margin:1rem 0;width:100%;display:flex;justify-content:space-between;align-items:flex-end;}&-label{font-family:\", \";font-size:2.6rem;color:\", \";}&-input{min-width:40rem;font-family:\", \";font-size:5rem;color:\", \";}&-link{font-family:\", \";font-size:1.7rem;color:\", \";}}\"], function (props) {\n  return props.theme.primary;\n}, function (props) {\n  return props.theme.MPBoldIt;\n}, function (props) {\n  return props.theme.primary;\n}, function (props) {\n  return props.theme.MPLight;\n}, function (props) {\n  return props.theme.primary;\n}, function (props) {\n  return props.theme.MPBoldIt;\n}, function (props) {\n  return props.theme.primary;\n}, function (props) {\n  return props.theme.MPBoldIt;\n}, function (props) {\n  return props.theme.primary;\n});\n\nvar Login =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Login, _Component);\n\n  // static getInitialProps = async function () {\n  //     const { logintoken } = cookie.get();\n  //     const res = await fetch('https://prelude.eurobrake.net/login', {\n  //         credentials: 'include',\n  // headers: {\n  //     Authorization: `Bearer ${logintoken}`,\n  // }\n  //     });\n  //     const data = await res.json();\n  //     return {\n  //         form: data\n  //     };\n  // };\n  function Login(props) {\n    var _this;\n\n    _classCallCheck(this, Login);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Login).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"saveToState\", function (e) {\n      _this.setState(_defineProperty({}, e.target.name, e.target.value));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSubmit\",\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(e) {\n        var _this$state, username, password, error, formData, response, data, data2, logintoken, _error;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                e.preventDefault();\n                _this$state = _this.state, username = _this$state.username, password = _this$state.password, error = _this$state.error; // const apiUrl = authorLogin ? 'https://prelude.eurobrake.net/login' : '' ;\n                // action=\"//2019.eurobrake.net/exhibition/exhibitors/login\" SHOULD BE LOGIN FORM FOR EXHIBITORS\n\n                formData = {\n                  username: username,\n                  password: password\n                };\n                _context.prev = 3;\n                _context.next = 6;\n                return fetch('https://prelude.eurobrake.net/login', {\n                  method: 'POST',\n                  credentials: 'include',\n                  body: _JSON$stringify(formData),\n                  headers: {\n                    'Content-Type': 'application/json'\n                  }\n                });\n\n              case 6:\n                response = _context.sent;\n                _context.next = 9;\n                return response;\n\n              case 9:\n                data = _context.sent;\n                _context.next = 12;\n                return response.json();\n\n              case 12:\n                data2 = _context.sent;\n                console.log('login', _JSON$stringify(data2));\n\n                if (!(data2.status === 'success')) {\n                  _context.next = 21;\n                  break;\n                }\n\n                logintoken = data2.logintoken;\n                _context.next = 18;\n                return login({\n                  logintoken: logintoken\n                });\n\n              case 18:\n                return _context.abrupt(\"return\", {});\n\n              case 21:\n                _error = new Error(data.error);\n                _error.response = response;\n                throw _error;\n\n              case 24:\n                _context.next = 30;\n                break;\n\n              case 26:\n                _context.prev = 26;\n                _context.t0 = _context[\"catch\"](3);\n                console.error('Failed to login, please try again', _context.t0);\n\n                _this.setState({\n                  error: _context.t0.message\n                });\n\n              case 30:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[3, 26]]);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n\n    _this.state = {\n      username: '',\n      password: '',\n      error: ''\n    };\n    return _this;\n  }\n\n  _createClass(Login, [{\n    key: \"render\",\n    value: function render() {\n      return __jsx(StyledForm, {\n        className: \"login_form\"\n      }, __jsx(\"div\", {\n        className: \"login_form-field\"\n      }, __jsx(\"label\", {\n        htmlFor: \"label\",\n        className: \"login_form-label\"\n      }, \"Email:\"), __jsx(TextField, {\n        style: {\n          color: '#134381'\n        },\n        id: \"standard-required\",\n        label: \"Required\",\n        className: \"login_form-input\",\n        type: \"text\",\n        name: \"username\",\n        onChange: this.saveToState,\n        value: this.state.username\n      })), __jsx(\"div\", {\n        className: \"login_form-field\"\n      }, __jsx(\"label\", {\n        className: \"login_form-label\",\n        htmlFor: \"label\"\n      }, \"Password:\"), __jsx(TextField, {\n        id: \"standard-required\",\n        label: \"Required\",\n        className: \"login_form-input\",\n        type: \"password\",\n        name: \"password\",\n        onChange: this.saveToState,\n        value: this.state.password\n      })), __jsx(Button, {\n        onClick: this.onSubmit,\n        value: \"Submit\",\n        bcolor: \"#134381\",\n        background: \"#134381\",\n        br: \"100rem\",\n        style: {\n          margin: \"3rem 0\"\n        },\n        fs: \"1.8rem\",\n        padding: \".5rem 6rem\"\n      }, \"Login\"), __jsx(\"a\", {\n        className: \"login_form-link\",\n        href: \"\"\n      }, \"Forgotten your password?\"));\n    }\n  }]);\n\n  return Login;\n}(Component);\n\nexport { Login as default };","map":null,"metadata":{},"sourceType":"module"}