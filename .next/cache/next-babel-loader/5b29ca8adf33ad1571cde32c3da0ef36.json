{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\nimport React, { Component } from 'react';\nimport styled from 'styled-components';\nvar DemoDiv = styled.div.withConfig({\n  displayName: \"login__DemoDiv\",\n  componentId: \"cxdurq-0\"\n})([\"display:flex;flex-direction:column;align-self:center;max-width:\", \";\"], function (props) {\n  return props.theme.maxWidth;\n});\nvar Demo = styled.h1.withConfig({\n  displayName: \"login__Demo\",\n  componentId: \"cxdurq-1\"\n})([\"padding:10rem;margin:5rem;color:orangered;\"]);\n\nvar login =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(login, _Component);\n\n  function login(props) {\n    var _this;\n\n    _classCallCheck(this, login);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(login).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"saveToState\", function (e) {\n      _this.setState(_defineProperty({}, e.target.name, e.target.value));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSubmit\",\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(e) {\n        var _this$state, authorLogin, uesername, password, error, apiUrl, formData, response, data, _error;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                e.preventDefault();\n                _this$state = _this.state, authorLogin = _this$state.authorLogin, uesername = _this$state.uesername, password = _this$state.password, error = _this$state.error;\n                apiUrl = authorLogin ? 'https://prelude.eurobrake.net/login' : ''; // action=\"//2019.eurobrake.net/exhibition/exhibitors/login\" SHOULD BE LOGIN FORM FOR EXHIBITORS\n\n                console.log('click');\n                formData = {\n                  username: username,\n                  password: password\n                };\n                _context.prev = 5;\n                _context.next = 8;\n                return fetch(apiUrl, {\n                  method: 'POST',\n                  credentials: 'include',\n                  body: _JSON$stringify(formData)\n                });\n\n              case 8:\n                response = _context.sent;\n\n                if (!response.ok) {\n                  _context.next = 16;\n                  break;\n                }\n\n                _context.next = 12;\n                return response.json();\n\n              case 12:\n                data = _context.sent;\n                return _context.abrupt(\"return\", {\n                  loggedIn: data\n                });\n\n              case 16:\n                console.log('login failed');\n                _error = new Error(response.statusText);\n                _error.response = response;\n                return _context.abrupt(\"return\", _Promise.reject(_error));\n\n              case 20:\n                _context.next = 26;\n                break;\n\n              case 22:\n                _context.prev = 22;\n                _context.t0 = _context[\"catch\"](5);\n                console.error('Failed to login, please try again', _context.t0);\n                throw new Error(_context.t0);\n\n              case 26:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[5, 22]]);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n\n    _this.state = {\n      username: '',\n      password: '',\n      authorLogin: true,\n      error: ''\n    };\n    return _this;\n  }\n\n  _createClass(login, [{\n    key: \"render\",\n    value: function render() {\n      console.log(this.props);\n      var form = this.props.form.form;\n      return __jsx(DemoDiv, {\n        onSubmit: this.onSubmit\n      }, __jsx(\"div\", {\n        className: \"\"\n      }, __jsx(\"label\", {\n        htmlFor: \"label\"\n      }, form[0].label), __jsx(\"input\", {\n        type: \"text\",\n        name: form[0].name,\n        onChange: this.saveToState,\n        value: this.state.username\n      })), __jsx(\"div\", {\n        className: \"\"\n      }, __jsx(\"label\", {\n        htmlFor: \"label\"\n      }, form[1].label), __jsx(\"input\", {\n        type: \"password\",\n        name: form[1].name,\n        onChange: this.saveToState,\n        value: this.state.password\n      })), __jsx(\"input\", {\n        type: \"submit\",\n        value: \"Submit\"\n      }));\n    }\n  }]);\n\n  return login;\n}(Component); // !!! NOTE IF I GO TO '/' IT GETS RID OF THE LOGGED IN COOKIE !!!\n\n\n_defineProperty(login, \"getInitialProps\",\n/*#__PURE__*/\nfunction () {\n  var _ref2 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2(ctx) {\n    var res, data;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            console.log(ctx);\n            _context2.next = 3;\n            return fetch('https://prelude.eurobrake.net/dashboard');\n\n          case 3:\n            res = _context2.sent;\n            _context2.next = 6;\n            return res.json()[\"catch\"](function (error) {\n              return console.log(error);\n            });\n\n          case 6:\n            data = _context2.sent;\n            ;\n            return _context2.abrupt(\"return\", {\n              form: data\n            });\n\n          case 9:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function (_x2) {\n    return _ref2.apply(this, arguments);\n  };\n}());\n\nexport { login as default };","map":null,"metadata":{},"sourceType":"module"}